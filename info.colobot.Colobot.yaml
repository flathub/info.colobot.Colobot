app-id: info.colobot.Colobot
runtime: org.freedesktop.Platform
runtime-version: '20.08'
sdk: org.freedesktop.Sdk
command: colobot
rename-icon: colobot
rename-desktop-file: colobot.desktop
finish-args:
  - --share=ipc
  - --socket=x11
  - --device=dri
  - --socket=pulseaudio
cleanup:
  - /bin/*.py
  - /include
  - /lib/pkgconfig
  - /lib/python*
  - /lib/libpython*
  - /share/man
  - '*.la'
  - '*.a'
modules:
  - shared-modules/glew/glew.json
  - shared-modules/glu/glu-9.json

  - name: boost
    buildsystem: simple
    build-commands:
      - ./bootstrap.sh --prefix=/app --with-libraries=filesystem,regex,system
      - ./b2 headers
      - ./b2 install
    sources:
      - type: archive
        url: https://boostorg.jfrog.io/artifactory/main/release/1.75.0/source/boost_1_75_0.tar.gz
        sha256: aeb26f80e80945e82ee93e5939baebdca47b9dee80a07d3144be1e1a6a66dd6a

  - name: physfs
    buildsystem: cmake-ninja
    config-opts:
      - -DPHYSFS_BUILD_TEST=off
    sources:
      - type: archive
        url: https://icculus.org/physfs/downloads/physfs-3.0.2.tar.bz2
        sha256: 304df76206d633df5360e738b138c94e82ccf086e50ba84f456d3f8432f9f863
        size: 194888
        x-checker-data:
          type: anitya
          project-id: 3631
          url-template: https://icculus.org/physfs/downloads/physfs-$version.tar.bz2

  - name: colobot
    builddir: true
    buildsystem: cmake-ninja
    build-options:
      cxxflags: -Wno-format-overflow
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DCOLOBOT_INSTALL_BIN_DIR=/app/bin
    sources:
      - type: archive
        url: https://github.com/colobot/colobot/archive/colobot-gold-0.2.0-alpha.tar.gz
        sha256: 633ce4ec9b54c657942453e769a2339befb2d0afff8b8b3589a73d005e097ab6
        x-checker-data:
          type: json
          url: https://api.github.com/repos/colobot/colobot/releases/latest
          version-query: .tag_name
          timestamp-query: .published_at
          url-query: '"https://github.com/colobot/colobot/archive/" + $version + ".tar.gz"'

      - type: patch
        path: colobot-0.2.0-appdata.patch

  # Uses Python 2.7 for localization
  - shared-modules/python2.7/python-2.7.json
  - name: colobot-data
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
    sources:
      - type: archive
        url: https://github.com/colobot/colobot-data/archive/colobot-gold-0.2.0-alpha.tar.gz
        dest-filename: colobot-data.tar.gz
        sha256: 4d6932f73830fa4ee9f37f6a18254c306fa804f74a2d78e9db7cb866a3a46a8b
        x-checker-data:
          type: json
          url: https://api.github.com/repos/colobot/colobot/releases/latest
          version-query: .tag_name
          timestamp-query: .published_at
          url-query: '"https://github.com/colobot/colobot-data/archive/" + $version
            + ".tar.gz"'
      - type: archive
        url: https://colobot.info/files/music/colobot-music_ogg_0.2.0-alpha.tar.gz
        sha256: 55e89d244f1f63e2467ef71253ca881ee31279f02aac9ac4706ef26c466306e9
        strip-components: 0
        dest: music/
        x-checker-data:
          type: json
          url: https://api.github.com/repos/colobot/colobot/releases/latest
          version-query: .tag_name | match("colobot-gold-(.*)") | .captures[0].string
          timestamp-query: .published_at
          url-query: '"https://colobot.info/files/music/colobot-music_ogg_" + $version
            + ".tar.gz"'
