---
app-id: info.colobot.Colobot
runtime: org.freedesktop.Platform
runtime-version: '18.08'
sdk: org.freedesktop.Sdk
command: colobot
rename-icon: colobot
rename-desktop-file: colobot.desktop
finish-args:
  - "--share=ipc"
  - "--socket=x11"
  - "--device=dri"
  - "--socket=pulseaudio"
cleanup:
  - "/include"
  - "/lib/pkgconfig"
  - "/share/pkgconfig"
  - "/share/aclocal"
  - "/share/doc"
  - "/man"
  - "/share/man"
  - "*.la"
  - "*.a"
modules:
  - shared-modules/glew/glew.json
  - shared-modules/glu/glu-9.0.0.json

  - name: boost
    buildsystem: simple
    build-commands:
      - "./bootstrap.sh --prefix=/app --with-libraries=system,filesystem,regex"
      - "./b2 headers -j $FLATPAK_BUILDER_N_JOBS"
      - "./b2 install -j $FLATPAK_BUILDER_N_JOBS"
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/project/boost/boost/1.64.0/boost_1_64_0.tar.bz2
        sha256: 7bcc5caace97baa948931d712ea5f37038dbb1c5d89b43ad4def4ed7cb683332

  - name: physfs
    buildsystem: cmake-ninja
    config-opts:
      - -DPHYSFS_BUILD_TEST=off
    sources:
      - type: archive
        url: https://icculus.org/physfs/downloads/physfs-3.0.1.tar.bz2
        sha256: b77b9f853168d9636a44f75fca372b363106f52d789d18a2f776397bf117f2f1

  - name: colobot
    builddir: true
    buildsystem: cmake-ninja
    build-options:
      cxxflags: "-Wno-format-overflow"
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DCOLOBOT_INSTALL_BIN_DIR=/app/bin
    sources:
      - type: archive
        url: https://github.com/colobot/colobot/archive/colobot-gold-0.1.11.1-alpha.tar.gz
        sha256: 8e57b84f109ce91cf2d311c38772f921ecb1a336ffafdea78455e5ac5824ce40
      - type: patch
        path: xdg-patch.patch

  - name: colobot-data
    buildsystem: cmake-ninja
    sources:
      - type: archive
        url: https://github.com/colobot/colobot-data/archive/colobot-gold-0.1.11.1-alpha.tar.gz
        sha256: 5e5e5c721a3cc89ffed4a90acb8e064c688e2fabc3da54c9ab7d49d199b73f66
      - type: file
        url: http://colobot.info/files/music/Intro1.ogg
        sha256: 287ad10983b02ed2b18d16e268a24cbf6f3766d32ded76a8f24687e6e5bccf4c
        dest: music/
      - type: file
        url: http://colobot.info/files/music/Intro2.ogg
        sha256: ff2e0efa90ca32a945e0003dfa765466c24783f574707171d606c248e1f4992d
        dest: music/
      - type: file
        url: http://colobot.info/files/music/music002.ogg
        sha256: 59a7bf9fa213cdb82b0da0a9188a40656ce717628c06ee8c59d60fe224e55041
        dest: music/
      - type: file
        url: http://colobot.info/files/music/music003.ogg
        sha256: 9a0e3ec764f38722289dbaf3e3593134905df82aa96cb6902e5e4ff3eeb10d30
        dest: music/
      - type: file
        url: http://colobot.info/files/music/music004.ogg
        sha256: 41b4b2ff2c1166817e91dced8379179441ce5a06e7ac145f34954ac2a9da6c86
        dest: music/
      - type: file
        url: http://colobot.info/files/music/music005.ogg
        sha256: 7944f802e06a0fa309c52cafad3cdb7e4f0d3ad766ffd6eeae06cd8bcae7886e
        dest: music/
      - type: file
        url: http://colobot.info/files/music/music006.ogg
        sha256: 98d58a7dc13a67f8189efc992d865c26da6a69bc742305d4393a203a92fdc87c
        dest: music/
      - type: file
        url: http://colobot.info/files/music/music007.ogg
        sha256: 5b1c4869647505161df36669bc0407f57f9a6c0142365e3944cae613d85868b3
        dest: music/
      - type: file
        url: http://colobot.info/files/music/music008.ogg
        sha256: de754096d1ff66112079fcae16fc47aa58f9854f78d120b7eb0def77ef2283ed
        dest: music/
      - type: file
        url: http://colobot.info/files/music/music009.ogg
        sha256: d0d1ccf45ec27d619f9717006559df11d83153b1997172618c1ade74ab84e6ec
        dest: music/
      - type: file
        url: http://colobot.info/files/music/music010.ogg
        sha256: 30fd973ad07d8a5c9659df64d9ee314195338b1fdfbbaf2381faa39d227cbe6a
        dest: music/
      - type: file
        url: http://colobot.info/files/music/music011.ogg
        sha256: 0071dfb1fba7cdab34c413b3ee91928736e98978f5de0ba57f8b1aac87b42464
        dest: music/
      - type: file
        url: http://colobot.info/files/music/music012.ogg
        sha256: d6e6b8d95e6b10b954a84dcbfb0eb49cc9e7af3f766016f31c6dcbb7db0b5392
        dest: music/
      - type: file
        url: http://colobot.info/files/music/music013.ogg
        sha256: 0d3e47cb6192db3e0f24bc9787720f63b7f681e21fa1f539109482e41759b2b3
        dest: music/
      - type: file
        url: http://colobot.info/files/music/Constructive.ogg
        sha256: 88fe18a880b010db36e00bb6d4a3405ac024ab09d80e6ffbb387ace682d78ccb
        dest: music/
      - type: file
        url: http://colobot.info/files/music/Humanitarian.ogg
        sha256: f025550711fb322368a44e6e5644edb763d9e8ba5898fe684198c6086c3cffad
        dest: music/
      - type: file
        url: http://colobot.info/files/music/Hv2.ogg
        sha256: 007d5fa44a619ca657de9baf8e0861f43ac1b8e76d0c7a6f44d834c0cc05b0fb
        dest: music/
      - type: file
        url: http://colobot.info/files/music/Quite.ogg
        sha256: 24fb3b86a1639d93fc0036c857f4adea53005312ab4f08b88260d32bd2c41bce
        dest: music/
      - type: file
        url: http://colobot.info/files/music/Infinite.ogg
        sha256: eb2b534ca7683125525fcc9173a41395ac3ea8532d26915061c87920f12f077a
        dest: music/
      - type: file
        url: http://colobot.info/files/music/Proton.ogg
        sha256: 6d9bd6d9367d0c4d7d32a5b00e72ad102e31586eb3baee696a61fe2538c787f4
        dest: music/
      - type: file
        url: http://colobot.info/files/music/Prototype.ogg
        sha256: f8b3f02b0a5f5a0afaffd92e4d7261b870804086638f784c8920aca08a71954e
        dest: music/

  - name: colobot-appdata
    buildsystem: simple
    build-commands:
      - "install -Dm644 -t /app/share/metainfo info.colobot.Colobot.appdata.xml"
    sources:
      - type: file
        path: info.colobot.Colobot.appdata.xml
